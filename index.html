<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>GestÃ£o Financeira Semanal</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1e1e2f;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #333;
      padding: 15px;
      text-align: center;
    }
    header h1 {
      color: #ffd700;
      margin: 0;
    }
    nav {
      display: flex;
      justify-content: center;
      background: #222;
    }
    nav button {
      padding: 10px 20px;
      background: #444;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    nav button.active {
      background: #ffd700;
      color: #000;
    }
    section {
      display: none;
      padding: 20px;
    }
    section.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #2c2c3c;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #333;
      color: #ffd700;
    }
    input, select {
      background: #1e1e2f;
      color: #fff;
      border: 1px solid #444;
      padding: 5px;
      border-radius: 4px;
    }
    .input-small {
      width: 80px;
    }
    button.download {
      padding: 10px 15px;
      margin: 10px 5px 20px 0;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button.download:hover {
      background-color: #218838;
    }
    #grafico-container {
      max-width: 600px;
      margin: 30px auto;
    }
    .total-box {
      font-size: 18px;
      margin-top: 10px;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #aaa;
    }
  </style>
</head>
<body>

<header>
  <h1>ðŸ“Š GestÃ£o Financeira Semanal</h1>
</header>

<nav>
  <button class="tab-btn active" onclick="mostrarAba('compras')">ðŸ›’ Compras Semanais</button>
  <button class="tab-btn" onclick="mostrarAba('resumo')">ðŸ“† Resumo Mensal</button>
</nav>

<section id="compras" class="active">
  <h2>ðŸ›’ Compras Semanais</h2>
  <label>ðŸ“… Semana:
    <select id="semana-select" onchange="carregarDadosSemana()">
      <option value="1">Semana 1</option>
      <option value="2">Semana 2</option>
      <option value="3">Semana 3</option>
      <option value="4">Semana 4</option>
      <option value="5">Semana 5</option>
    </select>
  </label>
  <label>ðŸ’° SalÃ¡rio da Semana: R$ <input id="salario-mercado" type="number" onchange="calcularTotais()" /></label>
  <table>
    <thead>
      <tr><th>Item</th><th>PreÃ§o UnitÃ¡rio</th><th>Quantidade</th><th>Total</th></tr>
    </thead>
    <tbody id="lista-mercado"></tbody>
  </table>

  <div class="total-box">
    <p><strong>ðŸ“¦ Gasto Total:</strong> R$ <span id="gasto-total">0.00</span></p>
    <p><strong>ðŸ’¼ Saldo Restante:</strong> R$ <span id="saldo-restante">0.00</span></p>
  </div>

  <button class="download" onclick="gerarRelatorioTXT()">ðŸ“¥ Baixar RelatÃ³rio (.TXT)</button>
  <button class="download" onclick="gerarRelatorioPDF()">ðŸ“„ Baixar RelatÃ³rio (.PDF)</button>

  <div id="grafico-container">
    <canvas id="graficoGastos"></canvas>
  </div>
</section>

<section id="resumo">
  <h2>ðŸ“† Resumo Mensal</h2>
  <div id="resumo-mensal"></div>
</section>

<footer>
  Â© Todos os direitos reservados - @moreldeveloper
</footer>

<script>
const mercadoItens = [
  "ðŸš Arroz", "ðŸ¥£ FeijÃ£o", "ðŸ›¢ï¸ Ã“leo", "ðŸ§‚ Sal", "ðŸ¬ AÃ§Ãºcar", "ðŸŒ¾ Trigo", "ðŸ¥© Carne", "ðŸŒ­ LinguiÃ§a", "ðŸ¥š Ovo", "ðŸ— Frango",
  "ðŸŒ­ Salsicha", "ðŸ¥“ Calabresa", "ðŸ¥“ Bacon", "ðŸ– Presunto", "ðŸ§€ Queijo", "ðŸ§ˆ Manteiga", "ðŸ¥„ RequeijÃ£o", "ðŸ… Ketchup", "ðŸ¥ª Maionese",
  "ðŸª Bolacha", "ðŸ¥¨ Torradinha", "ðŸŸ Salgadinho", "ðŸ§ƒ Suco", "ðŸ¥¤ Refrigerante", "ðŸ¦ Iogurte", "ðŸ® Danone", "ðŸ¥› Leite", "ðŸ« Achocolatado",
  "ðŸ« Chocolate", "ðŸ¬ Guloseimas", "ðŸž Padaria", "ðŸŽ Frutas", "ðŸ¥¬ Verduras", "ðŸ§½ Detergente", "ðŸ§¼ SabÃ£o em pÃ³", "ðŸ§´ Amaciante",
  "ðŸ§ª Ãgua SanitÃ¡ria", "ðŸ§¹ Limpa Tudo", "ðŸ§¼ Desinfetante", "ðŸ§¼ Sabonete", "ðŸ§´ Shampoo", "ðŸ§´ Condicionador", "ðŸ§¼ Desodorante",
  "ðŸ§´ Creme de Pentear", "ðŸ§´ Creme de Pele", "ðŸª¥ Pasta de Dente", "ðŸ¼ Fralda", "ðŸ“¦ Outros"
];

let chart;
let dadosSemanas = {};

function gerarTabelaMercado() {
  const tabela = document.getElementById('lista-mercado');
  tabela.innerHTML = "";
  mercadoItens.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item}</td>
      <td><input class="input-small" type="number" step="0.01" onchange="calcularTotais()" /></td>
      <td><input class="input-small" type="number" onchange="calcularTotais()" /></td>
      <td class="total-item">R$ 0.00</td>
    `;
    tabela.appendChild(tr);
  });
}

function calcularTotais() {
  let total = 0;
  let labels = [];
  let values = [];
  const semana = document.getElementById('semana-select').value;
  const salario = parseFloat(document.getElementById('salario-mercado').value) || 0;
  const linhas = document.querySelectorAll('#lista-mercado tr');
  dadosSemanas[semana] = { salario: salario, itens: [] };

  linhas.forEach(linha => {
    const preco = parseFloat(linha.children[1].children[0].value) || 0;
    const qtd = parseFloat(linha.children[2].children[0].value) || 0;
    const subtotal = preco * qtd;
    linha.children[3].innerText = `R$ ${subtotal.toFixed(2)}`;
    total += subtotal;
    dadosSemanas[semana].itens.push({ preco, qtd });
    if (subtotal > 0) {
      labels.push(linha.children[0].innerText);
      values.push(subtotal);
    }
  });

  const saldo = salario - total;
  document.getElementById('gasto-total').innerText = total.toFixed(2);
  document.getElementById('saldo-restante').innerText = saldo.toFixed(2);
  localStorage.setItem('comprasSemanais', JSON.stringify(dadosSemanas));
  atualizarGrafico(labels, values);
}

function carregarDadosSemana() {
  const semana = document.getElementById('semana-select').value;
  const data = JSON.parse(localStorage.getItem('comprasSemanais')) || {};
  dadosSemanas = data;
  gerarTabelaMercado();
  if (data[semana]) {
    document.getElementById('salario-mercado').value = data[semana].salario || 0;
    const linhas = document.querySelectorAll('#lista-mercado tr');
    data[semana].itens.forEach((item, i) => {
      if (linhas[i]) {
        linhas[i].children[1].children[0].value = item.preco;
        linhas[i].children[2].children[0].value = item.qtd;
      }
    });
  } else {
    document.getElementById('salario-mercado').value = 0;
  }
  calcularTotais();
}

function atualizarGrafico(labels, values) {
  const ctx = document.getElementById('graficoGastos').getContext('2d');
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{ data: values, backgroundColor: values.map(() => `hsl(${Math.random() * 360}, 70%, 50%)`) }]
    },
    options: {
      plugins: {
        legend: { labels: { color: '#fff' } }
      }
    }
  });
}

function gerarRelatorioTXT() {
  const semana = document.getElementById('semana-select').value;
  let relatorio = `--- RELATÃ“RIO DE COMPRAS - SEMANA ${semana} ---\n\n`;
  const salario = parseFloat(document.getElementById('salario-mercado').value) || 0;
  relatorio += `SalÃ¡rio: R$ ${salario.toFixed(2)}\n\n`;
  const linhas = document.querySelectorAll('#lista-mercado tr');
  linhas.forEach(linha => {
    const item = linha.children[0].innerText;
    const preco = parseFloat(linha.children[1].children[0].value) || 0;
    const qtd = parseFloat(linha.children[2].children[0].value) || 0;
    const total = preco * qtd;
    if (qtd > 0) {
      relatorio += `${item}: R$ ${preco.toFixed(2)} x ${qtd} = R$ ${total.toFixed(2)}\n`;
    }
  });
  relatorio += `\nTotal Gasto: R$ ${parseFloat(document.getElementById('gasto-total').innerText).toFixed(2)}\n`;
  relatorio += `Saldo: R$ ${parseFloat(document.getElementById('saldo-restante').innerText).toFixed(2)}\n`;
  const blob = new Blob([relatorio], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `relatorio_semana_${semana}.txt`;
  a.click();
  URL.revokeObjectURL(a.href);
}

function gerarRelatorioPDF() {
  const semana = document.getElementById('semana-select').value;
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  doc.setFontSize(12);
  doc.text(`RELATÃ“RIO DE COMPRAS - SEMANA ${semana}`, 10, y);
  y += 10;
  const salario = parseFloat(document.getElementById('salario-mercado').value) || 0;
  doc.text(`SalÃ¡rio: R$ ${salario.toFixed(2)}`, 10, y);
  y += 10;
  const linhas = document.querySelectorAll('#lista-mercado tr');
  linhas.forEach(linha => {
    const item = linha.children[0].innerText;
    const preco = parseFloat(linha.children[1].children[0].value) || 0;
    const qtd = parseFloat(linha.children[2].children[0].value) || 0;
    const total = preco * qtd;
    if (qtd > 0 && y < 280) {
      doc.text(`${item}: R$ ${preco.toFixed(2)} x ${qtd} = R$ ${total.toFixed(2)}`, 10, y);
      y += 10;
    }
  });
  y += 10;
  doc.text(`Total Gasto: R$ ${parseFloat(document.getElementById('gasto-total').innerText).toFixed(2)}`, 10, y);
  y += 10;
  doc.text(`Saldo: R$ ${parseFloat(document.getElementById('saldo-restante').innerText).toFixed(2)}`, 10, y);
  doc.save(`relatorio_semana_${semana}.pdf`);
}

function gerarResumoMensal() {
  const data = JSON.parse(localStorage.getItem('comprasSemanais')) || {};
  let totalMes = 0;
  let totalSalario = 0;
  let html = '<table><tr><th>Semana</th><th>SalÃ¡rio</th><th>Gasto</th><th>Saldo</th></tr>';
  for (let semana = 1; semana <= 5; semana++) {
    const s = data[semana];
    if (s) {
      const salario = parseFloat(s.salario) || 0;
      let totalSemana = 0;
      s.itens.forEach(item => {
        totalSemana += (parseFloat(item.preco) || 0) * (parseFloat(item.qtd) || 0);
      });
      const saldo = salario - totalSemana;
      totalSalario += salario;
      totalMes += totalSemana;
      html += `<tr><td>Semana ${semana}</td><td>R$ ${salario.toFixed(2)}</td><td>R$ ${totalSemana.toFixed(2)}</td><td>R$ ${saldo.toFixed(2)}</td></tr>`;
    }
  }
  const saldoFinal = totalSalario - totalMes;
  html += `<tr><th>Total</th><th>R$ ${totalSalario.toFixed(2)}</th><th>R$ ${totalMes.toFixed(2)}</th><th>R$ ${saldoFinal.toFixed(2)}</th></tr></table>`;
  document.getElementById('resumo-mensal').innerHTML = html;
}

function mostrarAba(id) {
  document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
  document.querySelector(`#${id}`).classList.add('active');
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  if (id === 'resumo') gerarResumoMensal();
}

document.addEventListener("DOMContentLoaded", () => {
  gerarTabelaMercado();
  carregarDadosSemana();
});
</script>

</body>
</html>